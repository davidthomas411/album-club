{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/dxt397/Documents/AlbumClub/app/api/fetch-album-metadata/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  const url = request.nextUrl.searchParams.get('url')\n\n  if (!url) {\n    return NextResponse.json({ error: 'URL is required' }, { status: 400 })\n  }\n\n  try {\n    // Detect platform\n    let platform = 'other'\n    if (url.includes('spotify.com')) platform = 'spotify'\n    else if (url.includes('music.apple.com')) platform = 'apple_music'\n    else if (url.includes('music.youtube.com')) platform = 'youtube_music'\n    else if (url.includes('soundcloud.com')) platform = 'soundcloud'\n    else if (url.includes('tidal.com')) platform = 'tidal'\n    else if (url.includes('bandcamp.com')) platform = 'bandcamp'\n\n    console.log('[v0] Fetching metadata for:', url, 'Platform:', platform)\n\n    // Fetch the page HTML to extract Open Graph metadata\n    const response = await fetch(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (compatible; AlbumClub/1.0)',\n      },\n    })\n\n    if (!response.ok) {\n      throw new Error('Failed to fetch URL')\n    }\n\n    const html = await response.text()\n\n    const titleMatch = html.match(/<meta property=\"og:title\" content=\"([^\"]+)\"/)\n    const descriptionMatch = html.match(/<meta property=\"og:description\" content=\"([^\"]+)\"/)\n    const imageMatch = html.match(/<meta property=\"og:image\" content=\"([^\"]+)\"/)\n    \n    console.log('[v0] Extracted image URL:', imageMatch ? imageMatch[1] : 'none')\n\n    let title = ''\n    let artist = ''\n\n    if (titleMatch) {\n      const fullTitle = titleMatch[1]\n      \n      // Platform-specific parsing\n      if (platform === 'spotify') {\n        // Spotify format: \"Album Name - Album by Artist | Spotify\"\n        const parts = fullTitle.split(' - ')\n        if (parts.length >= 2) {\n          title = parts[0].trim()\n          const artistPart = parts[1].replace(/Album by |, on Spotify|\\| Spotify/gi, '').trim()\n          artist = artistPart.split(',')[0].trim()\n        }\n      } else if (platform === 'apple_music') {\n        // Apple Music format: \"Album Name - Album by Artist - Apple Music\"\n        const parts = fullTitle.split(' - ')\n        if (parts.length >= 2) {\n          title = parts[0].trim()\n          artist = parts[1].replace(/Album by |on Apple Music/gi, '').trim()\n        }\n      } else if (platform === 'youtube_music') {\n        // YouTube Music format varies, try to parse\n        const parts = fullTitle.split(' - ')\n        if (parts.length >= 2) {\n          artist = parts[0].trim()\n          title = parts[1].replace(/\\| Album|YouTube Music/gi, '').trim()\n        }\n      } else {\n        // Generic parsing: try to split by common separators\n        if (fullTitle.includes(' - ')) {\n          const parts = fullTitle.split(' - ')\n          artist = parts[0].trim()\n          title = parts[1].trim()\n        } else if (fullTitle.includes(' by ')) {\n          const parts = fullTitle.split(' by ')\n          title = parts[0].trim()\n          artist = parts[1].trim()\n        } else {\n          title = fullTitle\n        }\n      }\n    }\n\n    // Fallback to description if title/artist not found\n    if (!artist && descriptionMatch) {\n      const description = descriptionMatch[1]\n      const byMatch = description.match(/by ([^,Â·]+)/)\n      if (byMatch) {\n        artist = byMatch[1].trim()\n      }\n    }\n\n    const result = {\n      title: title || 'Unknown Album',\n      artist: artist || 'Unknown Artist',\n      platform,\n      albumArtwork: imageMatch ? imageMatch[1] : null,\n    }\n\n    console.log('[v0] Returning metadata:', result)\n\n    return NextResponse.json(result)\n  } catch (error) {\n    console.error('[v0] Error fetching album metadata:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch album metadata' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}